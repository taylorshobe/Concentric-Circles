# Extract max phrase length, per Phrase Group
max_length = max(len(phrase.split()) for phrase in phrases) - 1

# Time Offset: START OR END OF THE CALL
time_offset = row['time_offset']
time_offset_condition = ""
field_name = ""

if time_offset != "None":
    if time_offset in ["before N from end", "within N from end"]:
        field_name = "end_seq"
    elif time_offset in ["after N from start", "within N from start"]:
        field_name = "start_seq"

    if time_offset in ["before", "before N from end"]:
        time_offset_condition = "<="
    elif time_offset in ["after", "after N from start"]:
        time_offset_condition = ">="
    elif time_offset in ["within N from start", "within N from end"]:
        time_offset_condition = "<="

# Offset Seconds Condition
seconds = float(row['offset_seconds']) if row['offset_seconds'] else None
milliseconds = seconds * 1000 if seconds else None
milliseconds_condition = ""

if milliseconds is not None and time_offset != "None":
    milliseconds_condition = f"AND Z.{field_name} {time_offset_condition} {milliseconds}"
