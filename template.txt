
# ... Other parts of q_scope_panel

dbc.Checklist(
    options=[
        {"label": "Join with uploaded file data", "value": "join"},
    ],
    value=[],
    id="join-file-upload-toggle",
    switch=True,
),

# ... Continue q_scope_panel definition



# ... The decorator for run_q_process

State("q-date-range", "value"),
State("scope-storage", "data"),
State("join-file-upload-toggle", "value")  # Add this line

# ... 

def run_q_process(n_clicks, q_date_range, memory_scope, join_toggle_value):  # Add join_toggle_value parameter
# ... Rest of the function



# ... Inside run_q_process

# If join_toggle_value contains 'join' (i.e., the switch is ON), and the uploaded DF is not empty, join the data
if 'join' in join_toggle_value and not df_upload.empty:  
    file_upload_join = "INNER JOIN file_upload F ON S.r_id = F.r_id"
else:
    file_upload_join = ""

# ... Rest of the function




